---
// src/components/PertanianDesa/PertanianLightbox.astro
---

<div id="lightbox" class="lightbox">
  <div class="lightbox-wrapper">
    <img id="lightbox-img" class="lightbox-content" src="" alt="Zoomed view" />
  </div>
</div>

<style>
  /* --- STYLE LIGHTBOX --- */
  .lightbox {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex; align-items: center; justify-content: center; padding: 0;
    opacity: 0; visibility: hidden;
    transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.3s ease;
    backdrop-filter: blur(5px);
    /* Tambahan: memastikan tidak ada padding yang menghalangi konten */
    padding: 10px !important; 
  }
  .lightbox.active { opacity: 1; visibility: visible; }
  
  .lightbox-wrapper {
    position: relative; width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center; pointer-events: none;
  }
  
  .lightbox-content {
    /* --- PERUBAHAN UKURAN DESKTOP --- */
    /* Ditingkatkan dari 85vw/85vh menjadi 95vw/95vh */
    max-width: 95vw; 
    max-height: 95vh;
    
    object-fit: contain; pointer-events: auto;
    border: 4px solid #ffffff; /* Border sedikit dipertipis agar konten lebih lega */
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6); border-radius: 2px;
    transform: scale(0.95); /* Skala awal sedikit lebih besar */
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  .lightbox.active .lightbox-content { transform: scale(1); }

  /* --- PERUBAHAN UKURAN MOBILE --- */
  @media (max-width: 600px) {
    .lightbox {
         padding: 5px !important; /* Margin layar lebih tipis di mobile */
    }
    .lightbox-content { 
        /* Lebar hampir penuh, tinggi dimaksimalkan */
        max-width: 98vw; 
        max-height: 92vh; /* Ditingkatkan dari 80vh */
        border-width: 2px; /* Border lebih tipis lagi di mobile */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); 
    }
  }
</style>

<script>
  // Logika Lightbox (Client Side)
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img');

  // Ekspos fungsi ke window agar bisa diakses oleh PertanianSlideshow
  window.openLightbox = function(url) {
      if (!lightbox || !lightboxImg) return;
      lightboxImg.src = url;
      lightbox.classList.add('active');
      document.body.classList.add('no-scroll');
      
      // Dispatch event agar Slideshow bisa pause otomatis
      window.dispatchEvent(new CustomEvent('lightbox:opened'));
  };

  function closeLightbox() {
      if (!lightbox || !lightbox.classList.contains('active')) return;
      
      lightbox.classList.remove('active');
      document.body.classList.remove('no-scroll');

      // Dispatch event agar Slideshow bisa resume otomatis
      window.dispatchEvent(new CustomEvent('lightbox:closed'));

      setTimeout(() => {
          if(lightboxImg) lightboxImg.src = '';
      }, 300);
  }

  // Event Listeners
  if (lightbox) {
      lightbox.addEventListener('click', (e) => {
          // Tutup jika klik di area hitam (wrapper), bukan di gambarnya
          if (e.target === lightbox || e.target.classList.contains('lightbox-wrapper')) {
              closeLightbox();
          }
      });
  }

  document.addEventListener('keydown', (e) => {
      if (e.key === "Escape") {
          closeLightbox();
      }
  });
</script>